<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Simulador de Crédito</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css"
    />
    <style>
      body {
        font-family: "Arial", sans-serif;
        background-color: #f8f9fa;
        margin: 0;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
        max-width: 900px;
        width: 100%;
      }
      h2,
      h3 {
        text-align: center;
        color: #333;
      }
      label {
        display: block;
        margin-top: 10px;
        font-weight: bold;
      }
      input,
      select {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        border: 1px solid #ccc;
        border-radius: 5px;
      }
      button {
        width: 100%;
        padding: 10px;
        margin-top: 20px;
        background-color: #007bff;
        border: none;
        color: white;
        font-size: 16px;
        border-radius: 5px;
        cursor: pointer;
        transition: background 0.3s;
      }
      button:hover {
        background-color: #0056b3;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: center;
      }
      th {
        background-color: #007bff;
        color: white;
      }
      .tabela-container {
        display: none;
      }

      .radio-group {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 10px;
    }

    .radio-group label {
        display: flex;
        align-items: center;
        cursor: pointer;
        font-weight: bold;
    }

    .radio-group input[type="radio"] {
        appearance: none;
        width: 18px;
        height: 18px;
        border: 2px solid #007bff;
        border-radius: 50%;
        margin-right: 8px;
        position: relative;
        cursor: pointer;
    }

    .radio-group input[type="radio"]:checked {
        background-color: #007bff;
        border-color: #007bff;
    }

    .radio-group input[type="radio"]::before {
        content: "";
        width: 10px;
        height: 10px;
        background-color: white;
        border-radius: 50%;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0);
        transition: 0.2s ease-in-out;
    }

    .radio-group input[type="radio"]:checked::before {
        transform: translate(-50%, -50%) scale(1);
    }
    </style>
  </head>
  <body>
    <div class="container">
        <h2>Simulador de Crédito Home Equity</h2>
    
        <label>Tipo de Cálculo:</label>
        <div class="radio-group">
            <label>
                <input type="radio" name="tipoCalculo" value="liquido" checked />
                Líquido
            </label>
            <label>
                <input type="radio" name="tipoCalculo" value="bruto" />
                Bruto
            </label>
        </div>
    
        <label>Valor do Imóvel: <input type="text" id="valorImovel" value="200000"></label>
        <label>Valor do Crédito (50% do imóvel): <input type="text" id="valorCredito" readonly></label>
        <label>Taxa de Juros (% a.m.): <input type="text" id="taxaJuros" value="1.69"></label>
        <label>Prazo (meses): <input type="text" id="prazo" value="180"></label>
        <label>Carência (meses): <input type="text" id="carencia" value="2"></label>
        <label>
            Tipo de Amortização:
            <select id="tipoAmortizacao">
                <option value="SAC">SAC</option>
                <option value="PRICE">PRICE</option>
            </select>
        </label>
        <button onclick="calcularSimulacao()">Calcular</button>
    </div>

    <div class="container tabela-container">
      <h3>Tabela de Simulação</h3>
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Saldo</th>
            <th>Amortização</th>
            <th>Juros</th>
            <th>Seguro MIP</th>
            <th>Seguro DFI</th>
            <th>Taxa ADM</th>
            <th>Valor Parcela</th>
          </tr>
        </thead>
        <tbody id="tabelaSimulacao"></tbody>
      </table>
    </div>

    <script>
        $(document).ready(function () {
            $("#valorImovel").on("input", function () {
                let valorImovel = parseFloat($(this).val().replace(/\./g, "").replace(",", ".")) || 0;
                let valorCredito = valorImovel * 0.5;
                $("#valorCredito").val(valorCredito.toLocaleString("pt-BR", { minimumFractionDigits: 2 }));
            }).trigger("input");
        });

        function calcularSimulacao() {
    let tipoCalculo = $("input[name='tipoCalculo']:checked").val();
    let valorImovel = parseFloat($('#valorImovel').val().replace(/\./g, '').replace(',', '.')) || 0;
    let valorCredito = valorImovel * 0.5;
    let iof = valorCredito * 0.035;  // IOF 3,72%
    let valorBrutoInicial = valorCredito + iof;  // Crédito + IOF
    let custoEmissao = valorBrutoInicial * 0.0526;  // Custo de emissão de 5,264% sobre o valor bruto

    let saldoDevedor;
    if (tipoCalculo === "liquido") {
        saldoDevedor = valorBrutoInicial + custoEmissao;  // No líquido, os custos são incorporados
    } else {
        saldoDevedor = valorCredito;  // No bruto, o valor inicial é apenas o crédito
    }

    console.log("Valor do IOF:", iof.toFixed(2));
    console.log("Custo de Emissão:", custoEmissao.toFixed(2));
    console.log("Saldo Devedor Inicial:", saldoDevedor.toFixed(2));

    let taxaJuros = parseFloat($('#taxaJuros').val().replace(',', '.')) / 100;
    let prazo = parseInt($('#prazo').val());
    let carencia = parseInt($('#carencia').val());
    let tipoAmortizacao = $('#tipoAmortizacao').val();

    let taxaADM = 25;
    let seguroDFI = 7.40;
    let seguroMIPPercentual = 0.0005;
    let tabela = $('#tabelaSimulacao');
    tabela.html("");

    tabela.append(`<tr>
        <td>0</td>
        <td>R$ ${saldoDevedor.toFixed(2)}</td>
        <td>R$ 0,00</td>
        <td>R$ 0,00</td>
        <td>R$ 0,00</td>
        <td>R$ 0,00</td>
        <td>R$ 0,00</td>
        <td>R$ 0,00</td>
    </tr>`);

    for (let mes = 1; mes <= carencia; mes++) {
        let juros = saldoDevedor * taxaJuros;
        saldoDevedor += juros;

        tabela.append(`<tr>
            <td>${mes}</td>
            <td>R$ ${saldoDevedor.toFixed(2)}</td>
            <td>R$ 0,00</td>
            <td>R$ ${juros.toFixed(2)}</td>
            <td>R$ 0,00</td>
            <td>R$ 0,00</td>
            <td>R$ 0,00</td>
            <td>R$ 0,00</td>
        </tr>`);
    }

    let amortizacao;
if (tipoAmortizacao === "SAC") {
    amortizacao = saldoDevedor / (prazo - carencia);  // Amortização fixa no SAC
}

for (let mes = carencia + 1; mes <= prazo; mes++) {
    let juros = saldoDevedor * taxaJuros;
    let seguroMIP = saldoDevedor * seguroMIPPercentual;

    let parcela;
    if (tipoAmortizacao === "SAC") {
        parcela = amortizacao + juros + taxaADM + seguroDFI + seguroMIP;  // Parcela decrescente
        saldoDevedor -= amortizacao;
    } else { // Cálculo para PRICE
        let fator = (taxaJuros * Math.pow(1 + taxaJuros, prazo - carencia)) / 
                    (Math.pow(1 + taxaJuros, prazo - carencia) - 1);
        parcela = saldoDevedor * fator + taxaADM + seguroDFI + seguroMIP;  // Parcela fixa
        amortizacao = parcela - juros - taxaADM - seguroDFI - seguroMIP;
        saldoDevedor -= amortizacao;
    }

    tabela.append(`<tr>
        <td>${mes}</td>
        <td>R$ ${saldoDevedor.toFixed(2)}</td>
        <td>R$ ${amortizacao.toFixed(2)}</td>
        <td>R$ ${juros.toFixed(2)}</td>
        <td>R$ ${seguroMIP.toFixed(2)}</td>
        <td>R$ ${seguroDFI.toFixed(2)}</td>
        <td>R$ ${taxaADM.toFixed(2)}</td>
        <td>R$ ${parcela.toFixed(2)} +IPCA</td>
    </tr>`);
}


    $(".tabela-container").fadeIn();
}


    </script>

  </body>
</html>

